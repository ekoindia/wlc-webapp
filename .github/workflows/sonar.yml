name: SonarQube Scan

on:
    push:
        branches:
            - dev

    pull_request:
        branches:
            - dev

jobs:
    sonarqube:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code

              uses: actions/checkout@v4

            - name: Set up Node.js

              uses: actions/setup-node@v4

              with:
                  node-version: "22"

            - name: Install dependencies

              run: npm ci

            - name: Run tests to generate coverage

              run: |

                  npm run test -- --coverage

            - name: SonarQube Scan

              env:
                  SONAR_TOKEN: ${{ secrets.SONARQUBE_ELOKA_TOKEN }}

                  SONAR_HOST_URL: https://lint.eko.in

              run: |

                  npm install -g sonar-scanner

                  sonar-scanner \

                    -Dsonar.login=${SONAR_TOKEN}
